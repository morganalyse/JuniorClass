/*! Version: 1.0.0; Third Party Notices: https://lpcres.delve.office.com/lpc/versionless/tpn-01d67aa9caf83cdfa3f747b1c21d0432ea8abdfcb0d9912f6791cb2edd1bd0abdd1da77c3af22b0de89e03a99a1d9790fea8374ed01710ba3c8d72168e7fd3a6.txt */
(window.webpackJsonpLpc=window.webpackJsonpLpc||[]).push([[5],{1135:function(t,e){},1619:function(t,e,a){"use strict";a.r(e);var n=a(7),i=a(46),o=a(44),r=a(2),s="ProfilePhotoPicker";function l(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,a="".concat(s).concat(t,"Action");return Object(r.a)(a,{featureName:s,exportOptions:e?{exportType:"UserInteraction",exportName:e}:void 0})}var u=l("CancelButtonClicked","ProfilePhotoPickerCancelButtonClicked"),c=l("CloseButtonClicked","ProfilePhotoPickerCloseButtonClickedAction"),d=l("DoneButtonClicked","ProfilePhotoPickerDoneButtonClickedAction"),h=l("UploadNewPhotoButtonClicked","ProfilePhotoPickerUploadNewPhotoButtonClickedAction"),p=l("ImageEditPaneDismissed","ProfilePhotoPickerImageEditPaneDismissed"),m=l("ImageUpdated"),g=l("LoadedCurrentImage"),f=l("LoadedEmptyImage"),v=l("LoadedNewImage"),S=l("SomethingWentWrong"),b=l("UploadStarted","ProfilePhotoPickerApplyButtonClicked"),y=l("UploadProgress"),k=l("UploadSucceeded"),C=l("WarningDismissed"),E={dataUrl:void 0,currentImageDataUrl:void 0,status:"READY",warning:void 0,show:!1,isUpdated:!1,uploadStart:0,uploadDuration:0},P=Object(i.a)().handleAction(u,O).handleAction(c,O).handleAction(d,O).handleAction(p,O).handleAction(C,function(t){return Object(n.l)(t,{status:"READY",warning:void 0})}).handleAction(g,function(t,e){var a=e.payload.dataUrl;return Object(n.l)(t,{dataUrl:t.dataUrl||a,currentImageDataUrl:t.currentImageDataUrl||a,isUpdated:!!e.payload.isSuggestedPhoto})}).handleAction(v,function(t,e){return Object(n.l)(t,{dataUrl:e.payload.dataUrl,status:"READY",warning:void 0,isUpdated:e.payload.dataUrl!==t.currentImageDataUrl})}).handleAction(f,function(t){return Object(n.l)(t,{dataUrl:"",status:"READY",warning:void 0,isUpdated:!!t.currentImageDataUrl})}).handleAction(b,function(t,e){return Object(n.l)(t,{status:"IN_PROGRESS",warning:void 0,uploadStart:e.payload.now,uploadDuration:0})}).handleAction(y,function(t,e){return"IN_PROGRESS"===t.status?Object(n.l)(t,{uploadDuration:e.payload.now-t.uploadStart}):t}).handleAction(k,function(t,e){return Object(n.l)(t,{currentImageDataUrl:e.payload.dataUrl,status:"SUCCESS",warning:void 0})}).handleAction(S,function(t,e){return Object(n.l)(t,{status:"SOMETHING_WENT_WRONG",warning:e.payload.warning})}).handleAction(m,function(t){return Object(n.l)(t,{isUpdated:!0})}).done(E),U=Object(o.a)("ProfilePhotoPickerStore",P,function(t){return t});function O(t){return Object(n.l)(t,{dataUrl:"",currentImageDataUrl:"",status:"READY",warning:void 0,isUpdated:!1})}var w=a(17),I=a(18),x=a(70),D=a(71),N=a(72),R=a(807),B=a(1161),A=a(1015),L=a(1066),T=a(1006),W=a(366),j=a(1189),M=a(1191),_=a(651),z=a(607),H=a(4),G=a(249);function F(t){try{return t.toDataURL("image/jpeg")}catch(t){return console.error(t),""}}var Y=a(45),X=a.n(Y),K=a(196),Z=a(477),V=a(1276),q=a(118);function J(t){var e=new DataView(function(t){for(var e=t.replace(/^data\:([^\;]+)\;base64,/i,""),a=atob(e),n=a.length,i=new ArrayBuffer(n),o=new Uint8Array(i),r=0;r<n;r++)o[r]=a.charCodeAt(r);return i}(t));if(65496!==e.getUint16(0,!1))return 1;for(var a,n=e.byteLength,i=2;i<n;){var o=e.getUint16(i,!1);if(i+=2,65505===o){if(1165519206!==e.getUint32(i+=2,!1))break;var r=18761===e.getUint16(i+=6,!1);i+=e.getUint32(i+4,r);var s=e.getUint16(i,r);i+=2;for(var l=0;l<s;l++)if(274===e.getUint16(i+12*l,r))return(a=e.getUint16(i+12*l+8,r))<1||a>8?1:a}else{if(65280!=(65280&o))break;i+=e.getUint16(i,!1)}}return 1}var Q=a(5),$=a(31),tt=a(506),et=Object(tt.b)(function(t,e){var a=t.palette;return Object($.X)({editControls:{display:"flex",flexDirection:"row",width:"100%",height:54},zoomButton:{selectors:{"&:disabled":{background:a.white}}},editCanvas:{backgroundColor:a.white,cursor:e?"move":"inherit"},invisible:Object(Q.a)({},{clip:"rect(1px, 1px, 1px, 1px)"},{height:1,overflow:"hidden",position:"absolute",whiteSpace:"nowrap",width:1}),slider:{flexGrow:1,marginTop:2,marginBottom:24,selectors:{".ms-Slider-thumb":{border:"2px solid ".concat(a.themePrimary)},".ms-Slider-active":{backgroundColor:a.themePrimary},".ms-Slider-inactive":{backgroundColor:a.themeLight}}},canvasContainer:{margin:"0 auto",display:"flex",alignItems:"center",flexDirection:"column",width:256,position:"relative"},textboy:{color:a.white,position:"absolute",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",top:0,left:0,width:256,height:256},initials:{fontSize:128,lineHeight:128}})}),at={1:[1,0,0,1,0,0],2:[-1,0,0,1,0,0],3:[-1,0,0,-1,0,0],4:[1,0,0,-1,0,0],5:[0,1,1,0,0,0],6:[0,1,-1,0,0,0],7:[0,-1,-1,0,0,0],8:[0,-1,1,0,0,0]},nt=function(t,e,a){return Math.min(a,Math.max(t,e))},it=function(t){function e(t){var a;return Object(w.a)(this,e),(a=Object(x.a)(this,Object(D.a)(e).call(this,t))).hasUnmounted=!1,a.editorCanvas=null,a.textBoy=null,a.initialState={xpos:0,ypos:0,absoluteScale:1,relativeScale:0,stepSize:.1,orientation:1,maximumScale:1,naturalMin:0,naturalWidth:0,naturalHeight:0,moving:!1,lastMouseX:0,lastMouseY:0,zoomInDisabled:!0,zoomOutDisabled:!0,image:void 0,initialRender:!0},a.state=X()({},a.initialState),a}return Object(N.a)(e,t),Object(I.a)(e,[{key:"render",value:function(){var t=this,e=!this.state.image||this.state.maximumScale<=1||this.props.progress>0,a=!e||this.state.naturalHeight!==this.state.naturalWidth,n=et(this.props.theme,a),i=1===this.props.progress?H.createElement("div",{className:n.textboy},H.createElement("span",{className:n.invisible},this.props.strings.success),H.createElement(Z.a,{className:n.initials,iconName:"CheckMark"})):null,o=nt(2*this.state.stepSize,.1,.2),r=e?H.createElement("div",{className:n.editControls}):H.createElement("div",{className:n.editControls},H.createElement(B.a,{className:n.zoomButton,iconProps:{iconName:"CalculatorSubtract"},title:this.props.strings.zoomOut,ariaLabel:this.props.strings.zoomOut,onClick:function(){return t.zoom(-o,128,128)},disabled:this.state.zoomOutDisabled,tabIndex:-1}),H.createElement(V.a,{ariaValueText:function(e){return"".concat(Math.round(100*(e*(t.state.maximumScale-1)+1)),"%")},ariaLabel:this.props.strings.zoom,className:n.slider,min:0,max:1,step:nt(this.state.stepSize,.05,.1),value:this.state.relativeScale,showValue:!1,onChange:function(e){return t.handleZoomSlider(e)}}),H.createElement(B.a,{className:n.zoomButton,iconProps:{iconName:"CalculatorAddition"},title:this.props.strings.zoomIn,ariaLabel:this.props.strings.zoomIn,onClick:function(){return t.zoom(o,128,128)},disabled:this.state.zoomInDisabled,tabIndex:-1}));return H.createElement("div",{className:n.canvasContainer},H.createElement("canvas",{className:n.editCanvas,role:"img",tabIndex:this.state.image?0:void 0,ref:function(e){return t.editorCanvas=e},width:256,height:256,onKeyDown:function(e){return t.onKeyboardHandler(e)},"aria-label":this.props.strings.dropZone}),H.createElement("div",{className:n.textboy,ref:function(e){return t.textBoy=e}},H.createElement("div",{className:n.initials},this.props.initials),H.createElement("div",null,this.props.strings.dropZone)),H.createElement("div",{role:"region","aria-live":"assertive","aria-atomic":!0},i),r)}},{key:"componentWillUnmount",value:function(){this.hasUnmounted=!0}},{key:"componentDidMount",value:function(){var t=this;this.props.dataUrl&&setTimeout(function(){return t.props.dataUrl&&t.loadImage(t.props.dataUrl)},0),this.attachEventListeners(),this.renderCanvasContent()}},{key:"shouldComponentUpdate",value:function(t,e){return!Object(K.a)(t,this.props)||!Object(K.a)(e,this.state)}},{key:"componentWillReceiveProps",value:function(t){t.dataUrl&&t.dataUrl!==this.props.dataUrl?this.loadImage(t.dataUrl):t.dataUrl!==this.props.dataUrl&&(this.state=X()({},this.initialState))}},{key:"componentDidUpdate",value:function(t){this.renderCanvasContent(),1===this.props.progress&&t.progress!==this.props.progress&&this.props.onRefocus()}},{key:"getImageDataUrlFromCanvas",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:648;if(!this.state.image)return"";var a=document.createElement("canvas"),n=this.state.naturalMin/this.state.absoluteScale;a.width=n,a.height=n;var i=a.getContext("2d");if(!i)return this.props.onError("UNSUPPORTED_BROWSER"),"";i.fillStyle="white",i.fillRect(0,0,a.width,a.height),this.state.image&&this.withCenterRotated(i,a.width,this.state.orientation,this.state.image,function(e,n){return i.drawImage(n,t.state.xpos*a.width/256,t.state.ypos*a.height/256,t.state.naturalWidth,t.state.naturalHeight)});for(var o=1;a.width*o/4>=e;)o/=2,i.drawImage(a,0,0,a.width*o,a.height*o);var r=document.createElement("canvas"),s=Math.min(this.state.naturalMin/this.state.absoluteScale,e);r.width=s,r.height=s;var l=r.getContext("2d");return l?(l.drawImage(a,0,0,a.width*o,a.width*o,0,0,s,s),F(r)):(this.props.onError("UNSUPPORTED_BROWSER"),"")}},{key:"loadImage",value:function(t){var e=this;if(t){var a=new Image;a.onload=function(){return e.imageLoaded(a)},a.src=t}else this.setState(this.initialState)}},{key:"imageLoaded",value:function(t){var e=this,a=Math.min(t.naturalWidth,t.naturalHeight),i=a/256,o=function(t){return-.5*(t/i-256)},r=Math.min(1,Math.max(.01,256/(2*Math.max(t.naturalWidth,t.naturalHeight)))),s=Object(n.l)(this.initialState,{naturalMin:a,naturalWidth:t.naturalWidth,naturalHeight:t.naturalHeight,stepSize:r,maximumScale:i,orientation:J(t.src),image:t,zoomInDisabled:!1,initialRender:!1,xpos:o(t.naturalWidth),ypos:o(t.naturalHeight)});!this.state.initialRender&&s.maximumScale<1&&(s.naturalHeight<48||s.naturalWidth<48?setTimeout(function(){return e.props.onError("IMAGE_TOO_SMALL_ERROR")},0):setTimeout(function(){return e.props.onError("IMAGE_TOO_SMALL_WARNING")},0)),this.props.isUploadedPhotoTooSmall(s.naturalHeight<48||s.naturalWidth<48),this.hasUnmounted||this.setState(s)}},{key:"renderCanvasContent",value:function(){var t=this,e=this.editorCanvas;if(e&&this.textBoy){var a=e.getContext("2d");if(a){var n=window.getComputedStyle(e);a.fillStyle=n.backgroundColor||"#ffffff",a.fillRect(0,0,1,1);var i=a.getImageData(0,0,1,1).data,o="rgba(".concat(i[0],", ").concat(i[1],", ").concat(i[2],", 0.6)"),r="rgba(".concat(i[0],", ").concat(i[1],", ").concat(i[2],", 1)");""===this.props.dataUrl?(a.fillStyle=this.props.textboyColor,this.textBoy.style.display="flex"):(a.fillStyle="white",this.textBoy.style.display="none"),a.fillRect(0,0,256,256),this.state.image&&this.withCenterRotated(a,256,this.state.orientation,this.state.image,function(e,a){return e.drawImage(a,t.state.xpos,t.state.ypos,t.state.naturalWidth*t.state.absoluteScale/t.state.maximumScale,t.state.naturalHeight*t.state.absoluteScale/t.state.maximumScale)}),a.save(),a.beginPath(),a.rect(0,0,256,256),a.arc(128,128,125,0,2*Math.PI,!0),a.clip(),a.fillStyle=o,a.fillRect(0,0,256,256),a.restore(),a.save(),a.beginPath(),a.arc(128,128,126,0,2*Math.PI,!0),a.lineWidth=2,a.strokeStyle=r,a.stroke(),a.restore(),a.save(),a.beginPath(),a.lineWidth=4,a.fillStyle="rgba(0, 120, 215, 0.5)",a.strokeStyle="rgba(0, 120, 215, 0.5)",a.arc(128,128,125,-Math.PI/2,2*this.props.progress*Math.PI-Math.PI/2,!1),1===this.props.progress&&a.fill(),a.stroke(),a.restore()}else this.props.onError("UNSUPPORTED_BROWSER")}}},{key:"withCenterRotated",value:function(t,e,a,n,i){t.save(),t.translate(e/2,e/2),t.transform.apply(t,at[a]),t.translate(-e/2,-e/2),i(t,n),t.restore()}},{key:"rotate",value:function(t,e,a){var n=at[a],i=n[0],o=n[2];return{x:(t-=128)*i+(e-=128)*n[1]+128,y:t*o+e*n[3]+128}}},{key:"attachEventListeners",value:function(){var t=this;this.editorCanvas&&this.textBoy&&(this.editorCanvas.addEventListener("dragenter",this.handleDragEnter.bind(this),!1),this.editorCanvas.addEventListener("dragleave",this.handleDragLeave.bind(this),!1),this.editorCanvas.addEventListener("dragover",this.stopEventDefaults.bind(this),!1),this.editorCanvas.addEventListener("drop",this.handleFileDrop.bind(this),!1),this.textBoy.addEventListener("dragenter",this.handleDragEnter.bind(this),!1),this.textBoy.addEventListener("dragleave",this.handleDragLeave.bind(this),!1),this.textBoy.addEventListener("dragover",this.stopEventDefaults.bind(this),!1),this.textBoy.addEventListener("drop",this.handleFileDrop.bind(this),!1),this.editorCanvas.addEventListener("mousedown",this.handleDragStart.bind(this),!1),this.editorCanvas.addEventListener("mousemove",function(e){return t.handleDrag(e,!0)},!1),this.editorCanvas.addEventListener("mouseup",function(e){return t.handleDrag(e,!1)},!1),this.editorCanvas.addEventListener("mouseleave",function(e){return t.handleDrag(e,!1)},!1),this.editorCanvas.addEventListener("wheel",this.handleWheel.bind(this),!1))}},{key:"stopEventDefaults",value:function(t){t.stopPropagation(),t.preventDefault()}},{key:"keepInside",value:function(t,e){return t>0?0:t+e<256?256-e:t}},{key:"handleZoomSlider",value:function(t){!this.state.image||this.state.maximumScale<1||this.zoom(t-this.state.relativeScale,128,128,!1)}},{key:"newScaledPosition",value:function(t,e,a,n){var i=t+(e-t)*n/this.state.absoluteScale,o=n*a/this.state.maximumScale;return this.keepInside(i,o)}},{key:"zoom",value:function(t,e,a){var i=this,o=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];if(this.state.image&&!(this.state.maximumScale<1)){var r=Math.min(1,Math.max(0,this.state.relativeScale+t));if(r!==this.state.relativeScale){var s=Math.exp(r*Math.log(this.state.maximumScale));this.setState(function(t,l){var u=s<=1,c=s>=t.maximumScale;return o&&(u||c)&&i.props.onRefocus(),Object(n.l)(t,{absoluteScale:s,relativeScale:r,zoomOutDisabled:u,zoomInDisabled:c,xpos:i.newScaledPosition(e,i.state.xpos,i.state.naturalWidth,s),ypos:i.newScaledPosition(a,i.state.ypos,i.state.naturalHeight,s)})}),this.props.onUpdate()}}}},{key:"handleWheel",value:function(t){if(this.state.image){this.stopEventDefaults(t);var e=t.deltaY>0?-1:1,a=this.rotate(t.offsetX,t.offsetY,this.state.orientation),n=a.x,i=a.y;this.zoom(nt(this.state.stepSize,.05,.1)*e,n,i)}}},{key:"handleDragStart",value:function(t){var e=this.rotate(t.clientX,t.clientY,this.state.orientation),a=e.x,i=e.y;this.state.image&&(this.stopEventDefaults(t),this.setState(function(t,e){return Object(n.l)(t,{moving:!0,lastMouseX:a,lastMouseY:i})}))}},{key:"handleDrag",value:function(t,e){this.stopEventDefaults(t);var a=this.rotate(t.clientX,t.clientY,this.state.orientation),i=a.x,o=a.y;if(this.state.image&&this.state.moving){var r=this.keepInside(this.state.xpos+(i-this.state.lastMouseX),this.state.naturalWidth*this.state.absoluteScale/this.state.maximumScale),s=this.keepInside(this.state.ypos+(o-this.state.lastMouseY),this.state.naturalHeight*this.state.absoluteScale/this.state.maximumScale);(this.state.xpos!==r||this.state.ypos!==s)&&this.props.onUpdate(),this.setState(function(t,a){return Object(n.l)(t,{moving:e,xpos:r,ypos:s,lastMouseX:i,lastMouseY:o})})}}},{key:"handleDragEnter",value:function(t){this.stopEventDefaults(t),this.editorCanvas&&(this.editorCanvas.style.outline="1px solid purple")}},{key:"handleDragLeave",value:function(t){this.stopEventDefaults(t),this.editorCanvas&&(this.editorCanvas.style.outline="none")}},{key:"handleFileDrop",value:function(t){this.handleDragLeave(t),t.dataTransfer&&this.props.onFileSelected(t.dataTransfer.files[0])}},{key:"onKeyboardHandler",value:function(t){var e=this;switch(t.key){case"+":return this.zoom(this.state.stepSize,128,128,!1);case"-":return this.zoom(-this.state.stepSize,128,128,!1)}var a=(t.which===q.a.left?1:t.which===q.a.right&&-1)||0,i=(t.which===q.a.up?1:t.which===q.a.down&&-1)||0,o=this.rotate(a,i,this.state.orientation),r=o.x,s=o.y;this.state.image&&this.setState(function(t,a){var i=r*t.naturalWidth/100,o=s*t.naturalHeight/100;return Object(n.l)(t,{xpos:e.keepInside(t.xpos+i,t.naturalWidth*t.absoluteScale/t.maximumScale),ypos:e.keepInside(t.ypos+o,t.naturalHeight*t.absoluteScale/t.maximumScale)})})}}]),e}(H.Component),ot=a(1018),rt=a(1267),st=Object(tt.b)(function(t){var e=t.palette;return Object($.X)({picker:t.fonts.medium,uploadHeader:t.fonts.xLarge,messageBarText:t.fonts.medium},{modal:{width:512,maxWidth:512,margin:0,selectors:{"#lpc-photo-picker .ms-Button-icon":{display:"inline-block",minWidth:16,padding:"0px 4px",backgroundColor:"transparent"},"#lpc-photo-picker .ms-Slider-slideBox:focus":{outline:"transparent"},"#lpc-photo-picker .ms-Button":{height:32,border:"none"},"#lpc-photo-picker .ms-Button--default":{marginLeft:0,backgroundColor:e.neutralLighter},"#lpc-photo-picker .ms-Button--icon &hover":{color:e.themePrimary},"#lpc-photo-picker .ms-Button--icon &active":{color:e.themeDarker},"#lpc-photo-picker .ms-Button--primary &:not([disabled])":{backgroundColor:e.themePrimary},"#lpc-photo-picker .ms-Button--primary &:hover":{backgroundColor:e.themeDarkAlt},"#lpc-photo-picker .ms-Button--primary &:active":{backgroundColor:e.themeDark},"#lpc-photo-picker .ms-Button--default .ms-Button-label":{color:e.neutralDark},"#lpc-photo-picker .ms-Button--default &:hover":{backgroundColor:e.neutralLight},"#lpc-photo-picker .ms-Button--default &:active":{backgroundColor:e.neutralTertiaryAlt}}},picker:{padding:32,overflow:"hidden"},header:{display:"flex",alignContent:"space-between"},uploadHeader:{color:e.neutralPrimary,fontWeight:300,marginBottom:7,flexGrow:1},messageBar:{margin:"7px 0"},messageBarText:{color:e.neutralPrimary},fileInput:{display:"none"},fileInputButton:{color:e.themePrimary,padding:0,margin:"0 0 12px -4px"},closeButton:{float:"right",marginTop:-20,marginRight:-20},removeButton:{marginLeft:"auto"},endActions:{alignItems:"center",display:"flex",selectors:{button:{marginRight:12,minWidth:90,padding:"0px 16px"}}}})}),lt=function(t){var e=st(t.theme),a="UNKNOWN"===t.warning,n="IMAGE_TOO_SMALL_ERROR"===t.warning,i=a||n?ot.a.error:ot.a.warning,o=a?void 0:t.onDismiss;return H.createElement(rt.a,{className:e.messageBar,messageBarType:i,onDismiss:o,isMultiline:!0,"aria-live":"polite",role:"region"},H.createElement("div",{className:e.messageBarText},t.warningText))},ut=function(t){function e(e){return 1/(1+Math.exp(-t*e))-.5}var a=.5/e(1);return function(t){return t<=0?0:t>1?1:a*e(2*t-1)+.5}}(5),ct=function(t){function e(t){var a;return Object(w.a)(this,e),(a=Object(x.a)(this,Object(D.a)(e).call(this,t))).editCanvas=null,a.fileInput=null,a.focusTrap=null,a.primaryButton=null,a.handleOnRemoveButtonClicked=function(){a.props.onLoadedEmptyImage()},a.handleOnSaveButtonClicked=function(){switch(a.props.status){case"SUCCESS":return a.props.onDone(),a.props.onDismiss();default:if(!a.editCanvas)return;var t=a.editCanvas.getImageDataUrlFromCanvas();a.props.onStartUpload(performance.now(),t,a.props.onUpload)}},a.handleUploadAnimation=function(){"IN_PROGRESS"===a.props.status&&a.props.onUploadProgress(performance.now())},a.handleOnCancelButtonClicked=function(){a.props.onCancel(),a.props.onDismiss()},a.handleOnCloseButtonClicked=function(){a.props.onClose(),a.props.onDismiss()},a.state={isUploadedPhotoTooSmall:!1},a}return Object(N.a)(e,t),Object(I.a)(e,[{key:"render",value:function(){var t=this,e=st(this.props.theme),a=this.getSaveButtonText(this.props.status),n=this.getWarningText(this.props.warning),i=Object(W.b)({text:this.props.personDisplayName}),o=Object(_.a)(this.props.personDisplayName,Object(z.a)());return H.createElement(M.a,{className:"lpc_nested_popup",containerClassName:e.modal,isOpen:!0,onDismiss:this.props.onDismiss,titleAriaId:this.props.strings.uploadHeader},H.createElement(j.a,{id:"lpc-photo-picker",className:e.picker,componentRef:function(e){return t.focusTrap=e},firstFocusableSelector:e.fileInputButton},H.createElement(B.a,{className:e.closeButton,iconProps:{iconName:"Cancel"},onClick:this.handleOnCloseButtonClicked,ariaLabel:this.props.strings.cancel}),H.createElement("div",{className:e.header},H.createElement("div",{className:e.uploadHeader},this.props.strings.uploadHeader)),n&&H.createElement(lt,{theme:this.props.theme,warning:this.props.warning,status:this.props.status,warningText:n,onDismiss:this.props.onDismissInfoBar}),H.createElement("input",{role:"button",className:e.fileInput,type:"file",ref:function(e){return t.fileInput=e},onClick:function(t){return t.currentTarget.value=""},onChange:function(e){return e.currentTarget.files&&t.props.onFileSelected(e.currentTarget.files[0])},"data-log-name":"PhotoPickerFileInput",accept:"image/*"}),H.createElement(A.a,{className:e.fileInputButton,iconProps:{iconName:"Add"},onClick:function(){t.fileInput&&t.fileInput.click(),t.props.onUploadNewPhoto()}},this.props.strings.upload),H.createElement(it,{theme:this.props.theme,ref:function(e){return t.editCanvas=e},dataUrl:this.props.dataUrl,initials:o,textboyColor:i,progress:this.props.progress,warning:n,strings:this.props.strings,onError:this.props.onError,isUploadedPhotoTooSmall:function(e){return t.setState({isUploadedPhotoTooSmall:e})},onFileSelected:this.props.onFileSelected,onRefocus:function(){return t.onFocusChange()},onUpdate:this.props.onImageUpdated}),H.createElement("div",{className:e.endActions},H.createElement(L.a,{disabled:!this.props.isUpdated||"IN_PROGRESS"===this.props.status||this.state.isUploadedPhotoTooSmall,onClick:this.handleOnSaveButtonClicked,"data-log-name":"PhotoPickerOkay",componentRef:function(e){return t.primaryButton=e}},a),this.props.progress>0?null:H.createElement(T.a,{onClick:this.handleOnCancelButtonClicked,"data-log-name":"PhotoPickerCancel"},this.props.strings.cancel),this.props.isImageRemovable&&H.createElement(A.a,{className:e.removeButton,iconProps:{iconName:"Delete"},onClick:this.handleOnRemoveButtonClicked,"data-log-name":"PhotoPickerDelete"},this.props.strings.remove))))}},{key:"componentDidMount",value:function(){var t=this;this.loadCurrentImage(),requestAnimationFrame(function(){return t.focusTrap&&t.focusTrap.focus()})}},{key:"componentWillUnmount",value:function(){this.props.onImageEditPaneDismissed()}},{key:"componentDidUpdate",value:function(t){"IN_PROGRESS"===this.props.status&&requestAnimationFrame(this.handleUploadAnimation),"IN_PROGRESS"===t.status&&"SUCCESS"===this.props.status&&this.primaryButton&&this.primaryButton.focus()}},{key:"onFocusChange",value:function(){"SUCCESS"===this.props.status?this.primaryButton&&this.primaryButton.focus():this.focusTrap&&this.focusTrap.focus()}},{key:"getSaveButtonText",value:function(t){switch(t){case"IN_PROGRESS":return this.props.strings.inProgress;case"SUCCESS":return this.props.strings.close;case"READY":case"SOMETHING_WENT_WRONG":return this.props.strings.apply;default:return Object(n.g)(t)}}},{key:"getWarningText",value:function(t){switch(t){case"IMAGE_TOO_SMALL_WARNING":return this.props.strings.imageTooSmall;case"IMAGE_TOO_SMALL_ERROR":return this.props.strings.imageTooSmallError;case"NOT_AN_IMAGE":return this.props.strings.notAnImage;case"UNKNOWN":return this.props.strings.somethingWentWrong;case"UNSUPPORTED_BROWSER":return this.props.strings.unsupportedBrowser;default:return""}}},{key:"loadCurrentImage",value:function(){var t=this,e=new Image;e.crossOrigin="Anonymous",e.onload=function(){return t.profileImageLoaded(e)},e.onerror=function(){return t.profileImageLoadFailed()},e.src=this.props.personImageUrl}},{key:"profileImageLoaded",value:function(t){var e=document.createElement("canvas");e.width=t.naturalWidth,e.height=t.naturalHeight;var a=e.getContext("2d");a?(a.drawImage(t,0,0),this.props.onLoadedCurrentImage(F(e),!!this.props.isSuggestedPhoto)):this.props.onError("UNSUPPORTED_BROWSER")}},{key:"profileImageLoadFailed",value:function(){this.props.onLoadedEmptyImage()}}]),e}(H.Component);var dt=Object(R.a)(Object(G.b)(function(t,e){var a=U.getSelectors(t),i=0;switch(a.status){case"IN_PROGRESS":var o=a.uploadDuration/2e3;i=.999999*ut(o);break;case"SUCCESS":i=1;break;case"READY":case"SOMETHING_WENT_WRONG":i=0;break;default:Object(n.g)(a.status)}return{dataUrl:a.dataUrl,initialImage:a.currentImageDataUrl,warning:a.warning,status:a.status,isUpdated:a.isUpdated,progress:i}},function(t){return{onDismissInfoBar:function(){return t(C())},onError:function(e){return t(S({warning:e}))},onUploadNewPhoto:function(){return t(h())},onFileSelected:function(e){return function(t,e){var a=new FileReader,n=function(){return t(S({warning:"NOT_AN_IMAGE"}))};a.onerror=n,a.onloadend=function(){var e=document.createElement("img");e.onerror=n,e.onload=function(){return t(v({dataUrl:e.src}))},e.src=String(a.result)},a.readAsDataURL(e)}(t,e)},onCancel:function(){return t(u())},onClose:function(){return t(c())},onDone:function(){return t(d())},onImageEditPaneDismissed:function(){return t(p())},onImageUpdated:function(){return t(m())},onLoadedCurrentImage:function(e,a){return t(g({dataUrl:e,isSuggestedPhoto:a}))},onLoadedEmptyImage:function(){return t(f())},onStartUpload:function(e,a,n){return function(t,e,a,n){t(b({now:e})),n(a,function(){return t(k({dataUrl:a}))},function(){return t(S({warning:"UNKNOWN"}))})}(t,e,a,n)},onUploadProgress:function(e){return t(y({now:e}))}}})(ct)),ht=a(1135),pt=a(617),mt=a(300),gt=a(783),ft=a(799),vt=a(55),St=!1;function bt(){St||(St=!0,Object(ft.a)(void 0,{disableWarnings:!0}))}var yt=null,kt=0,Ct=function(t){function e(){return Object(w.a)(this,e),Object(x.a)(this,Object(D.a)(e).apply(this,arguments))}return Object(N.a)(e,t),Object(I.a)(e,[{key:"componentWillMount",value:function(){if(kt>=1)throw new Error("Can only mount one StandaloneProfilePhotoPicker at a time.");if(kt+=1,bt(),null===yt){var t=Object(vt.createStore)(Object(pt.a)([U]));yt=new mt.a({reduxStore:t})}}},{key:"componentWillUnmount",value:function(){kt-=1}},{key:"render",value:function(){return yt?H.createElement(gt.a,{context:yt},H.createElement(dt,this.props)):null}}]),e}(H.Component);a.d(e,"ProfilePhotoPickerStore",function(){return U}),a.d(e,"ProfilePhotoPicker",function(){return dt}),a.d(e,"IProfilePhotoPickerProps",function(){return ht.IProfilePhotoPickerProps}),a.d(e,"IProfilePhotoPickerStrings",function(){return ht.IProfilePhotoPickerStrings}),a.d(e,"StandaloneProfilePhotoPicker",function(){return Ct}),a.d(e,"initIcons",function(){return bt})}}]);
self.scriptsLoaded = self.scriptsLoaded || {}; self.scriptProcessStart = self.scriptProcessStart || {}; self.scriptProcessStart['owa.PersonaPhoto.js'] = (new Date()).getTime();(window.$wj=window.$wj||[]).push([[403],{1414:function(e,t,n){"use strict";var r,i,o;n.d(t,"c",function(){return r}),n.d(t,"b",function(){return i}),n.d(t,"a",function(){return o}),function(e){e[e.tiny=0]="tiny",e[e.extraExtraSmall=1]="extraExtraSmall",e[e.extraSmall=2]="extraSmall",e[e.small=3]="small",e[e.regular=4]="regular",e[e.large=5]="large",e[e.extraLarge=6]="extraLarge",e[e.size8=17]="size8",e[e.size10=9]="size10",e[e.size16=8]="size16",e[e.size24=10]="size24",e[e.size28=7]="size28",e[e.size32=11]="size32",e[e.size40=12]="size40",e[e.size48=13]="size48",e[e.size56=16]="size56",e[e.size72=14]="size72",e[e.size100=15]="size100",e[e.size120=18]="size120"}(r||(r={})),function(e){e[e.none=0]="none",e[e.offline=1]="offline",e[e.online=2]="online",e[e.away=3]="away",e[e.dnd=4]="dnd",e[e.blocked=5]="blocked",e[e.busy=6]="busy"}(i||(i={})),function(e){e[e.lightBlue=0]="lightBlue",e[e.blue=1]="blue",e[e.darkBlue=2]="darkBlue",e[e.teal=3]="teal",e[e.lightGreen=4]="lightGreen",e[e.green=5]="green",e[e.darkGreen=6]="darkGreen",e[e.lightPink=7]="lightPink",e[e.pink=8]="pink",e[e.magenta=9]="magenta",e[e.purple=10]="purple",e[e.black=11]="black",e[e.orange=12]="orange",e[e.red=13]="red",e[e.darkRed=14]="darkRed",e[e.transparent=15]="transparent",e[e.violet=16]="violet",e[e.lightRed=17]="lightRed",e[e.gold=18]="gold",e[e.burgundy=19]="burgundy",e[e.warmGray=20]="warmGray",e[e.coolGray=21]="coolGray",e[e.gray=22]="gray",e[e.cyan=23]="cyan",e[e.rust=24]="rust"}(o||(o={}))},14468:function(e,t,n){"use strict";n.r(t);var r=n(948);n.d(t,"downloadPersonaPhoto",function(){return r.a})},154:function(e,t,n){"use strict";var r=n(0),i=n(163),o=n(138),c=n(180),a=n(298),u=n.n(a),s=n(46),l=n(334),d=n.n(l),f=n(50),b=500,h="OWA_GetAccessTokenForResource";function v(e){return Object(r.__awaiter)(this,void 0,void 0,function(){var t;return Object(r.__generator)(this,function(n){return t={isUserActivity:!1},[2,d()(u()({Resource:e}),t)]})})}function p(e,t,n){return Object(r.__awaiter)(this,void 0,void 0,function(){return Object(r.__generator)(this,function(r){return t<1?(Object(f.g)(h,[e,t,n.toString()]),[2,Promise.reject()]):[2,v(e).catch(function(n){return Object(s.a)(b).then(function(){return p(e,t-1,n)})})]})})}var g,_=n(67),m=n(249),O=3,j=500;function w(e){var t=this,n=null,i=null,o=new Promise(function(e,o){return Object(r.__awaiter)(t,void 0,void 0,function(){return Object(r.__generator)(this,function(t){return n=e,i=o,[2]})})}),c={onFulfilled:n,onRejected:i,resource:e};return(null==g&&(g=new m.a(O,k,j)),g).add(c),o}function k(e){return Object(r.__awaiter)(this,void 0,void 0,function(){return Object(r.__generator)(this,function(t){return U(e.resource).then(function(t){e.onFulfilled(t)}).catch(function(t){e.onRejected(t)}),[2]})})}var T=n(166);n.d(t,"e",function(){return C}),n.d(t,"b",function(){return R}),n.d(t,"c",function(){return E}),n.d(t,"a",function(){return U}),n.d(t,"d",function(){return P});var y=1,A=12e4,z=3,x=null;function C(e){x=e}function R(e){return Object(r.__awaiter)(this,void 0,void 0,function(){var t;return Object(r.__generator)(this,function(n){switch(n.label){case 0:return null!=(t=P(G(),e))?[3,2]:[4,U(e)];case 1:t=n.sent(),n.label=2;case 2:return[2,null!=t?t.AccessToken:void 0]}})})}function E(e){var t=P(G(),e);if(t)return[t.AccessToken,void 0];if(Object(_.f)("auth-getAccessTokenQueueEnabled")){var n=Object(T.a)(e),r=void 0;return n?r=n:(r=w(e),Object(T.b)(e,r)),[void 0,r.then(function(t){return Object(T.c)(e),t.AccessToken})]}return[void 0,U(e).then(function(e){return e.AccessToken})]}function U(e){return Object(r.__awaiter)(this,void 0,void 0,function(){var t,n,i;return Object(r.__generator)(this,function(r){switch(r.label){case 0:return Object(_.f)("auth-getAccessTokenQueueEnabled")?[4,p(e,z)]:[3,2];case 1:return n=r.sent(),[3,4];case 2:return[4,v(e)];case 3:n=r.sent(),r.label=4;case 4:return null!=(t=n)&&0==t.TokenResultCode&&null!=t.AccessTokenExpiry&&(t.ExpiresIn&&t.ExpiresIn>0&&(t.AccessTokenExpiry=Object(c.a)(Date.now(),t.ExpiresIn).toISOString()),(i=new Date(t.AccessTokenExpiry).getTime()-Date.now()-A)>0&&G().put(e,t,i,function(e,t){U(e).catch(function(){})})),[2,t]}})})}function P(e,t){var n=e.get(t),r=void 0;n&&n.AccessTokenExpiry&&(Object(o.a)(new Date(n.AccessTokenExpiry),-y)>new Date(Date.now())&&(r=n));return r}function G(){return null==x&&(x=new i.Cache),x}},163:function(e,t,n){"use strict";function r(){var e=Object.create(null),t=0,n=0,r=0,i=!1;function o(t){r--,delete e[t]}this.put=function(t,n,i,c){if(void 0!==i&&("number"!=typeof i||isNaN(i)||i<=0))throw new Error("Cache timeout must be a positive number");if(void 0!==c&&"function"!=typeof c)throw new Error("Cache timeout callback must be a function");var a=e[t];a?clearTimeout(a.timeout):r++;var u={value:n,expire:i+Date.now()};return isNaN(u.expire)||(u.timeout=setTimeout(function(){o(t),c&&c(t,n)}.bind(this),i)),e[t]=u,n},this.del=function(t){var n=!0,r=e[t];return r?(clearTimeout(r.timeout),!isNaN(r.expire)&&r.expire<Date.now()&&(n=!1)):n=!1,n&&o(t),n},this.clear=function(){for(var o in e)clearTimeout(e[o].timeout);r=0,e=Object.create(null),i&&(t=0,n=0)},this.get=function(o){var c=e[o];if(void 0!==c){if(isNaN(c.expire)||c.expire>=Date.now())return i&&t++,c.value;i&&n++,r--,delete e[o]}else i&&n++;return null},this.size=function(){return r},this.memsize=function(){var t,n=0;for(t in e)n++;return n},this.debug=function(e){i=e},this.hits=function(){return t},this.misses=function(){return n},this.keys=function(){return Object.keys(e)},this.exportJson=function(){var t={};for(var n in e){var r=e[n];t[n]={value:r.value,expire:r.expire||"NaN"}}return JSON.stringify(t)},this.importJson=function(t,n){var r=JSON.parse(t),i=Date.now(),o=n&&n.skipDuplicates;for(var c in r)if(r.hasOwnProperty(c)){if(o)if(e[c])continue;var a=r[c],u=a.expire-i;if(u<=0){this.del(c);continue}u=u>0?u:void 0,this.put(c,a.value,u)}return this.size()}}e.exports=new r,e.exports.Cache=r},166:function(e,t,n){"use strict";n.d(t,"a",function(){return c}),n.d(t,"c",function(){return a}),n.d(t,"b",function(){return u});var r=n(163),i=null;function o(){return null==i&&(i=new r.Cache),i}function c(e){return o().get(e)}function a(e){return o().del(e)}function u(e,t){o().put(e,t)}},298:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0);t.default=function(e){return r.__assign({__type:"TokenRequest:#Exchange"},e)}},334:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(131),i=n(298);t.default=function(e,t){return void 0===e||e.__type||(e=i.default(e)),r.makeServiceRequest("GetAccessTokenforResource",e,t)}},463:function(e,t,n){"use strict";n.r(t);var r=n(163),i=n(154);function o(e){Object(i.e)(new r.Cache),Object(i.b)(e.location.origin)}var c=n(0),a=n(40),u=n(183),s=n.n(u),l=n(180),d=n(50),f="OWA_GetDelegationAccessToken",b={};function h(e){return Object(c.__awaiter)(this,void 0,void 0,function(){var t,n,r,i;return Object(c.__generator)(this,function(o){switch(o.label){case 0:t=e.client_id+e.scope,n=encodeURIComponent(t),r={},o.label=1;case 1:return o.trys.push([1,3,4,5]),[4,v(e,window)];case 2:return r=o.sent(),[3,5];case 3:return i=o.sent(),r.TokenResultCode=2,Object(d.g)(f+" Token fetch failure ",[i.toString(),e]),[3,5];case 4:return function(e,t){var n=t.document.getElementById(e);null!=n&&(n.removeEventListener("load",b[e]),t.document.body.removeChild(n),delete b[e])}(n,window),[7];case 5:return[2,r]}})})}function v(e,t){return Object(c.__awaiter)(this,void 0,void 0,function(){var n,r,i;return Object(c.__generator)(this,function(o){return n=encodeURIComponent(e.client_id+e.scope),r=function(e){var t={response_type:"token",prompt:"none",redirect_uri:e.redirect_uri,scope:e.scope,client_id:e.client_id};return e.authorization_uri+"?"+a.stringify(t)}(e),t.document.getElementById(n)?[2,{TokenResultCode:2}]:((i=t.document.createElement("iframe")).src=r.toString(),i.style.display="none",i.id=n,t.document.body.appendChild(i),[2,new Promise(function(r,o){b[n]=function(n){var c={};try{i.contentWindow&&i.contentWindow.location.host==t.location.host&&(c=function(e){var t=a.parse(e),n={};t.access_token?(n.AccessToken=t.access_token,n.AccessTokenExpiry=Object(l.a)(Date.now(),parseInt(t.expires_in)).toISOString(),n.TokenResultCode=0):"login_required"==t.error||"interaction_required"==t.error||"consent_required"==t.error?(n.TokenResultCode=3,Object(d.g)(f+" MSA Failure ",[t.error,e])):(n.TokenResultCode=2,Object(d.g)(f+" MSA Failure ",[t.error,e]));return n}(i.contentWindow.location.hash.substring(1)))}catch(t){Object(d.g)(f+" Hash param parsing failure ",[t.toString(),e]),c.TokenResultCode=2,o(c)}r(c)},i.addEventListener("load",b[n],!1)})])})})}var p,g=n(67),_=n(166),m=n(249),O=3,j=500;function w(e){var t=this,n=null,r=null,i=new Promise(function(e,i){return Object(c.__awaiter)(t,void 0,void 0,function(){return Object(c.__generator)(this,function(t){return n=e,r=i,[2]})})}),o={onFulfilled:n,onRejected:r,options:e};return(null==p&&(p=new m.a(O,k,j)),p).add(o),i}function k(e){return Object(c.__awaiter)(this,void 0,void 0,function(){return Object(c.__generator)(this,function(t){return h(e.options).then(function(t){e.onFulfilled(t)}).catch(function(t){e.onRejected(t)}),[2]})})}var T=null,y="OWA_GetDelegationAccessToken";function A(e){return Object(c.__awaiter)(this,void 0,void 0,function(){var t,n,r,i,o;return Object(c.__generator)(this,function(c){switch(c.label){case 0:t={scope:e,client_id:"",authorization_uri:"",redirect_uri:""},n=void 0,c.label=1;case 1:return c.trys.push([1,5,,6]),[4,s()()];case 2:return 0!=(r=c.sent()).ResultCode||null==r.ImplicitGrantAuthorizationUrl||""==r.ImplicitGrantAuthorizationUrl?(Object(d.g)(y+" ImplicitGrantAuthorizationUrl is empty or null "),[2,n]):(i=a.parse(r.ImplicitGrantAuthorizationUrl.split("?")[1]||"")).client_id&&i.redirect_uri?(t.client_id=i.client_id,t.authorization_uri=r.ImplicitGrantAuthorizationUrl.split("?")[0],t.redirect_uri=i.redirect_uri,[4,z(t)]):[3,4];case 3:n=c.sent(),c.label=4;case 4:return[2,n];case 5:return o=c.sent(),Object(d.g)(y+" GetAuthenticationUrl Operation failed ",[o.toString()]),[2,n];case 6:return[2]}})})}function z(e){return Object(c.__awaiter)(this,void 0,void 0,function(){var t,n,r,o;return Object(c.__generator)(this,function(c){switch(c.label){case 0:return t=e.client_id+e.scope,(n=Object(i.d)(C(),t))&&n.AccessToken?[2,n.AccessToken]:[3,1];case 1:return Object(g.f)("auth-getDelegationTokenQueueEnabled")?(r=Object(_.a)(t),o=void 0,r?o=r:(o=w(e),Object(_.b)(t,o)),[2,o.then(function(e){return x(t,e),Object(_.c)(t),e.AccessToken})]):[3,2];case 2:return[4,h(e)];case 3:return n=c.sent(),x(t,n),[2,0==n.TokenResultCode?n.AccessToken:void 0]}})})}function x(e,t){if(t&&0==t.TokenResultCode&&t.AccessTokenExpiry){var n=new Date(t.AccessTokenExpiry).getTime()-Date.now();n>0&&C().put(e,t,n)}}function C(){return null==T&&(T=new r.Cache),T}var R=n(121),E=n(340);var U=!1;function P(e){U||(!function(e){var t=Object(E.a)("/owa",e);Object(R.initializeServiceRequest)({baseUrl:t})}(e),U=!0)}function G(e,t,n,r){n?e.acquireTokenPopup(t,null,n,r):e.acquireToken(t,r)}var I=n(51),S=new I.c(function(){return Promise.all([n.e(563),n.e(109)]).then(n.bind(null,14939))}),F=new I.a(S,function(e){return e.createAdalAuthenticationContext});var D=function(e,t,n,r){return function(i,o){i||!o?r(i,null):(e.getCachedUser(),G(e,t,n,r))}},B="adalIdTokenFrame";function N(e,t,n,r){e.config.displayCall=function(i){!function(e){if(-1==e.indexOf("?"))throw new Error("Invalid Url in Adal Auth Context Display Call")}(i),window.detectUserCachedCallback=D(e,t,n,r),function(e,t){e._addAdalFrame(B).src="about:blank",e._loadFrame(t+"&prompt=none",B)}(e,i)},e.login()}function L(e,t,n,r,i){return Object(c.__awaiter)(this,void 0,void 0,function(){var o;return Object(c.__generator)(this,function(c){switch(c.label){case 0:return"https://login.microsoftonline.com/",[4,F.importAndExecute("https://login.microsoftonline.com/",e,t)];case 1:return o=c.sent(),o.getCachedUser()?G(o,n,r,i):N(o,n,r,i),[2]}})})}n.d(t,"registerTokenProvider",function(){return o}),n.d(t,"getAccessTokenforResource",function(){return i.b}),n.d(t,"getAccessTokenforResourceAsLazy",function(){return i.c}),n.d(t,"getDelegationToken",function(){return z}),n.d(t,"getDelegationTokenForOwa",function(){return A}),n.d(t,"bootstrap",function(){return P}),n.d(t,"getAccessTokenOnBehalfOfResource",function(){return L})},767:function(e,t,n){"use strict";n.d(t,"a",function(){return b}),n.d(t,"b",function(){return h});var r=n(868),i=n(757),o=n(1414),c=n(162),a=n(121),u="email",s="personId",l="UA",d="size",f="/service.svc/s/GetPersonaPhoto";function b(e,t,n,o){if(Object(i.a)())return Object(r.a)(e,n);var c=Object(a.getConfig)().baseUrl,b="";return e&&(b=v(b,u,e&&e.toLowerCase())),t&&(b=v(b,s,t)),b=v(b,l,"0"),b=v(b,d,o?"HR96x96":"HR64x64"),""+c+f+"?"+b}function h(e,t,n){return Object(i.a)()?Object(r.a)(e,t):"https://cid-"+e+".users.storage.live.com/users/0x"+e+"/myprofile/expressionprofile/profilephoto:"+function(e){switch(e){case o.c.tiny:case o.c.extraExtraSmall:case o.c.extraSmall:case o.c.small:case o.c.regular:case o.c.large:case o.c.size10:case o.c.size8:case o.c.size16:case o.c.size24:case o.c.size28:case o.c.size32:return"UserTileStatic,UserTileSmall";case o.c.extraLarge:case o.c.size40:case o.c.size48:case o.c.size56:case o.c.size72:case o.c.size100:case o.c.size120:return"UserTileMedium,UserTileStatic,UserTileSmall";default:return Object(c.a)(e)}}(n)+"/MeControlMediumUserTile?ck=1&ex=24&fofoff=1"}function v(e,t,n){n&&(n=encodeURIComponent(n));var r=t+"="+n;return e&&(r=e+"&"+r),r}},868:function(e,t,n){"use strict";n.d(t,"a",function(){return o});var r=n(5),i="https://substrate.office.com/profile/v1.0/{0}/{1}/image/$value";function o(e,t){var n=e.indexOf("@")>-1,o="GroupMailbox"==t?"groups":"users";return Object(r.b)(i,o,n?e:"cid:"+e)}},948:function(e,t,n){"use strict";var r=n(0),i=n(823),o=n(70),c=Object(o.action)("setIsPendingFetch")(function(e,t){e.personaBlob.isPendingFetch=t}),a=n(868),u=n(767),s=n(757),l=n(153),d=n(5),f=n(463),b=n(63),h=n(217),v=n.n(h),p=n(182),g=n.n(p);n.d(t,"a",function(){return T});var _="GetProfileImageTime",m="GetPersonaTime",O="GetProfileImageNoPhoto",j="GetPersonaResponseNoPhoto",w="https://outlook.office.com/M365.Access",k={};function T(e,t,n){return Object(r.__awaiter)(this,void 0,void 0,function(){var i,o;return Object(r.__generator)(this,function(r){switch(r.label){case 0:if(i=e.personaBlob,!t&&(i.isPendingFetch||i.hasFetchFailed||i.blobUrl&&k[i.blobUrl]||Object(d.g)(e.emailAddress)&&Object(d.g)(e.personaId)||n&&n()))return[2];c(e,!0),r.label=1;case 1:return r.trys.push([1,3,4,5]),[4,Object(s.a)()?A(e,t):y(e,t)];case 2:return r.sent(),[3,5];case 3:throw o=r.sent(),b.d.warn("Error in getPersonaPhoto "+o),o;case 4:return c(e,!1),[7];case 5:return[2]}})})}function y(e,t){return Object(r.__awaiter)(this,void 0,void 0,function(){var n,i,o,c,a,s;return Object(r.__generator)(this,function(r){switch(r.label){case 0:return n=z(),i=new Headers,t&&i.append("Cache-Control","no-cache"),o=g()({isUserActivity:!1,returnFullResponseOnSuccess:!0,headers:i,method:"GET"}),[4,v()(Object(u.a)(e.emailAddress,e.personaId),o)];case 1:return c=r.sent(),a=x,s=[e],[4,c.blob()];case 2:return a.apply(void 0,s.concat([r.sent()])),n.end(),[2]}})})}function A(e,t){return Object(r.__awaiter)(this,void 0,void 0,function(){var n,o,c,u,s,l,d,b,h;return Object(r.__generator)(this,function(r){switch(r.label){case 0:return[4,Object(f.getDelegationTokenForOwa)(w)];case 1:return(n=r.sent())?(d=Object(a.a)(e.emailAddress,e.mailboxType),b=z(),[4,fetch(d,{method:"GET",mode:"cors",headers:{"Cache-Control":t?"no-cache":void 0,"Content-Type":"image/gif",Authorization:"Bearer "+n,"X-AnchorMailbox":e.emailAddress,image_verified_flag:""}})]):(o=e.name,c=e.emailAddress,u=e.personaId,s=e.size,l=e.mailboxType,i.a.add({name:o,emailAddress:c,personaId:u,size:s,mailboxType:l}),[2]);case 2:return[4,r.sent().blob()];case 3:return h=r.sent(),x(e,h),b.end(),[2]}})})}function z(){var e=Object(s.a)()?_:m;return new l.b(e)}var x=Object(o.action)("processGetPhotoResponse")(function(e,t){c(e,!1);var n,r=0==t.type.toLowerCase().indexOf("image"),i=t.size<100;if(r&&!i)return e.personaBlob.blobUrl=URL.createObjectURL(t),k[e.personaBlob.blobUrl]=!0,void(e.personaBlob.hasFetchFailed=!1);n=Object(s.a)()?O:j,Object(l.n)(n),e.personaBlob.hasFetchFailed=!0})}},0,[563,109]]);
//# sourceMappingURL=owa.PersonaPhoto.js.map
self.scriptsLoaded['owa.PersonaPhoto.js'] = 1; self.scriptProcessEnd = self.scriptProcessEnd || {}; self.scriptProcessEnd['owa.PersonaPhoto.js'] = (new Date()).getTime();
self.scriptsLoaded = self.scriptsLoaded || {}; self.scriptProcessStart = self.scriptProcessStart || {}; self.scriptProcessStart['owa.ExpandedListSelectionActions.js'] = (new Date()).getTime();(window.$wj=window.$wj||[]).push([[228],{14753:function(e,t,n){"use strict";n.r(t);var o=n(5),a=n(20),r=n(727),i=n(753),s=n(1904),c=n(63);function d(e,t){var n=function(e){var t={},n=i.a.conversationNodes.get(e);for(;n;){if(t[n.internetMessageId]){c.d.error("Invalid loop found in ParentInternetMessageId pointers");break}if(Object(s.b)(n.internetMessageId)&&(t[n.internetMessageId]=!0),Object(o.g)(n.parentInternetMessageId))break;n=i.a.conversationNodes.get(n.parentInternetMessageId)}return t}(e);if(1===Object.keys(n).length)return function(e,t){var n=new a.ObservableMap({});return t.forEach(function(t){var o=i.a.conversationNodes.get(t),a=t===e?r.a.CheckMark:r.a.None;n.set(o.internetMessageId,a)}),n}(e,t);for(var d=new a.ObservableMap({}),u=!1,l=!1,v=0,I=0;I<t.length;I++){var b=i.a.conversationNodes.get(t[I]);n[b.internetMessageId]?(u?v+1===Object.keys(n).length?(d.set(b.internetMessageId,r.a.BusEnd),l=!0):d.set(b.internetMessageId,r.a.BusStop):(d.set(b.internetMessageId,r.a.BusStart),u=!0),v++):!u||l?d.set(b.internetMessageId,r.a.None):d.set(b.internetMessageId,r.a.NoStop)}return d}var u=n(867),l=n(744),v=n(6318),I=n(735),b=n(4);function O(){var e=l.a.expandedConversationViewState;e.expandedRowKey=null,e.focusedNodeId=null,e.selectedNodeIds=[],e.allNodeIds=[],e.shouldBeExpanded=!1,e.busStopStateMap=new a.ObservableMap({})}Object(b.mutator)(u.t,function(e){var t=e.nodeId,n=l.a.expandedConversationViewState,o=n.selectedNodeIds,a=n.allNodeIds;l.a.expandedConversationViewState.focusedNodeId=t,o.indexOf(t)>-1?(o.splice(o.indexOf(t),1),1===o.length&&(l.a.expandedConversationViewState.busStopStateMap=d(o[0],a))):o.push(t)}),Object(b.mutator)(u.h,function(e){l.a.expandedConversationViewState.busStopStateMap=new a.ObservableMap({})}),Object(b.mutator)(u.q,function(e){var t=e.rowKey,n=e.nodeIdToSelect,o=e.allNodeIds,a=l.a.expandedConversationViewState;a.expandedRowKey=t,a.focusedNodeId=n,a.selectedNodeIds=[n],a.allNodeIds=o,a.busStopStateMap=d(n,o)}),Object(b.mutator)(u.u,function(e){e.mailListItemSelectionSource==I.c.MailListItemCheckbox&&O()}),Object(b.mutator)(u.p,function(e){O()}),Object(b.mutator)(u.i,function(e){O()}),Object(b.mutator)(u.k,function(e){O()}),Object(b.mutator)(u.r,function(e){var t=l.a.expandedConversationViewState;e.mailListItemSelectionSource==I.c.MailListItemTwisty&&t.expandedRowKey!=e.rowKey&&(t.expandedRowKey=e.rowKey,t.shouldBeExpanded=!0)}),Object(b.mutator)(u.o,function(e){l.a.expandedConversationViewState.shouldBeExpanded=e.shouldBeExpanded}),Object(b.mutator)(v.a,function(e){if(1===l.a.expandedConversationViewState.selectedNodeIds.length){var t=l.a.expandedConversationViewState.selectedNodeIds[0],n=I.I.conversations.get(e.conversationId).conversationNodeIds;l.a.expandedConversationViewState.busStopStateMap=d(t,n)}});var f,w=n(0),p=n(6904),m=n(1845),S=n(1263),j=n(801),x=n(5004);Object(b.orchestrator)(u.b,function(e){V(e.itemId,e.tableView,e.nodeId,e.allNodeIds,e.mailListItemSelectionSource)});Object(b.orchestrator)(u.e,function(e){if(e.mailListItemSelectionSource==I.c.MailListItemTwisty){if(1==e.listViewType)throw new Error("Toggle expansion action cannot be called from message view");var t,n;Object(p.a)(e.rowKey)?C():(t=e.rowKey,n=e.tableView,u.o(!1),Object(x.a)(n,!1),h(t,n))}}),Object(b.orchestrator)(u.c,function(e){Object(p.a)(e.rowKey)&&C()}),Object(b.orchestrator)(u.m,function(e){for(var t=r.b.getConversationId(e.rowKey,e.tableView),n=I.I.conversations.get(t),o=null,a=null,i=n.conversationNodeIds.indexOf(r.O.expandedConversationViewState.selectedNodeIds[0])+1;i<n.conversationNodeIds.length;i++){var c=n.conversationNodeIds[i],d=Object(s.b)(c);if(d){a=d.ItemId.Id,o=c;break}}o?V(a,e.tableView,o,n.conversationNodeIds,I.c.RowRemoval):h(e.rowKey,e.tableView)});var g=0,N=!0;function V(e,t,n,o,a){if(f&&(clearTimeout(f),f=null),Object(m.f)(t,!0,a),a!==I.c.KeyboardUpDown||Object(j.b)())S.n.importAndExecute(e,!0);else{var i=Date.now(),s=i-g;g=i,(N||s<=500)&&(N=!1,f=setTimeout(function(){f=null,N=!0,S.n.importAndExecute(e,!0)},250))}u.q(r.O.expandedConversationViewState.expandedRowKey,n,o,t.id)}function h(e,t){var n,o,a=r.b.getConversationId(e,t),i=I.I.conversations.get(a);try{for(var c=Object(w.__values)(i.conversationNodeIds),d=c.next();!d.done;d=c.next()){var u=d.value,l=Object(s.b)(u);if(l){V(l.ItemId.Id,t,u,i.conversationNodeIds,I.c.RowRemoval);break}}}catch(e){n={error:e}}finally{try{d&&!d.done&&(o=c.return)&&o.call(c)}finally{if(n)throw n.error}}}function C(){u.i()}var y=n(5640),R=n(5643),M=(Object(b.orchestrator)(R.a,function(e){Object(y.a)(),1===Object(r.E)().expandedConversationViewState.selectedNodeIds.length&&u.h()}),n(7330)),E=n(997),K=(Object(b.orchestrator)(M.a,function(e){if(r.O.expandedConversationViewState.expandedRowKey){var t=I.I.conversations.get(e.conversationId);u.q(r.O.expandedConversationViewState.expandedRowKey,e.conversationNodeId,t.conversationNodeIds,Object(E.a)())}}),n(6324)),_=n(4657),P=n(5082),T=n(1772);function L(e,t,n){return Object(T.a)()?1===e&&n===r.d.Next||0===e&&n===r.d.Previous:e===t-1&&n===r.d.Next||e===t-2&&n===r.d.Previous}Object(b.orchestrator)(K.a,function(e){var t=e.selectionDirection,n=e.tableView,o=e.mailListItemSelectionSource,a=Object(w.__read)(function(e,t){var n=r.O.expandedConversationViewState,o=n.focusedNodeId,a=n.allNodeIds;if(!o)return[null,null];var i,c,d=a.indexOf(o);e===r.d.Next?(i=a.length-1,c=1):(i=0,c=-1);var u=Object(r.F)(t.focusedRowKey,t.id).id,l=r.O.conversationItems.get(u);for(;d!==i;){if(d+=c,Object(_.a)(l.id)&&L(d,a.length,e))return Object(P.a)(l.clientId),["loading",null];var v=a[d],I=Object(s.b)(v);if(I)return[v,I]}return[null,null]}(t,n),2),i=a[0],c=a[1];"loading"!==i&&(i?u.b(i,c.ItemId.Id,r.O.expandedConversationViewState.allNodeIds,n,o):r.O.expandedConversationViewState.expandedRowKey&&t===r.d.Previous?u.c(r.O.expandedConversationViewState.expandedRowKey):u.n(n,t,o))});var D=n(1078),A=n(6325);Object(b.orchestrator)(A.a,function(e){var t=e.tableView,n=e.selectedNodeIds,o=e.selectedRowKeys,a=e.mailListItemSelectionSource;if(n.length>0&&a===D.a.KeyboardEnter){if(1!==n.length)return;u.b(n[0],Object(s.b)(n[0]).ItemId.Id,r.O.expandedConversationViewState.allNodeIds,t,a)}else{if(1!==o.length)return;u.r(t,o[0],!0,a)}})},4303:function(e,t,n){"use strict";var o=n(2357),a=n(50);t.a=Object(a.c)("expandCollapsedItemsRollUp",o.a.RPCountExpCollItemsRollUp)(function(e,t){void 0===t&&(t=!1),e.conversationNodeIdsInCollapsedItemsRollUp=[]})},4657:function(e,t,n){"use strict";n.d(t,"a",function(){return a});var o=n(753);function a(e){var t=o.a.conversations.get(e);return t&&t.canLoadMore}},5082:function(e,t,n){"use strict";var o=n(4303),a=n(2357),r=n(873),i=n(2732),s=n(153),c=n(50),d=n(860),u=n(753),l=n(2893),v=n(70);t.a=Object(c.c)("loadMore",a.a.RPCountLoadMore)(Object(v.select)({conversations:function(){return u.a.conversations},conversationReadingPaneViewState:function(){return r.a.conversationReadingPaneViewState}})(function(e,t){if(e&&t.conversations.has(e.Id)){var n=t.conversations.get(e.Id);n.isLoadMoreInProgress=!0,n.maxItemsToReturn=n.maxItemsToReturn+d.c,n.syncState="";var a=Object(s.o)();return a&&a.addCustomData([(r=n.maxItemsToReturn,c=Math.ceil((r-20)/10),Object(l.a)(c))]),Object(i.b)(t.conversationReadingPaneViewState)&&Object(o.a)(t.conversationReadingPaneViewState,!0),Object(d.h)(e,"LoadMore")}var r,c;return Promise.resolve()}))},5640:function(e,t,n){"use strict";var o=n(0),a=n(3488),r=n(3483),i=n(1977),s=n(991),c=n(885),d=n(1625),u=n(70),l=n(727);t.a=Object(u.select)({composeViewState:function(){return c.a.viewStates.get(c.a.primaryComposeId)},conversationItems:function(){return l.O.conversationItems}})(Object(u.action)("reloadReadingPane")(function(e){var t=Object(l.B)(),n=t?Object(o.__spread)(t.selectedRowKeys.keys()):[];if(1==n.length){var c=l.b.getRowClientItemId(n[0],t),u=Object(d.a)(n,t)[0];switch(t.tableQuery.listViewType){case 0:var v=e.conversationItems.get(c.Id);e.composeViewState&&e.composeViewState.isInlineCompose?s.x.importAndExecute(e.composeViewState).then(function(){Object(a.b)(c,u,v.subject)}):Object(a.b)(c,u,v.subject);break;case 1:e.composeViewState&&e.composeViewState.isInlineCompose?s.x.importAndExecute(e.composeViewState).then(function(){Object(r.a)(c,u,i.a)}):Object(r.a)(c,u,i.a)}}}))},5643:function(e,t,n){"use strict";var o=n(4),a=Object(o.action)("ON_CONVERSATION_OPTION_SAVED");t.a=a},6318:function(e,t,n){"use strict";var o=n(4);t.a=Object(o.action)("UPDATE_LOADED_CONVERSATION_READING_PANE",function(e,t){return{conversationId:e,nodeIdCollectionChanged:t}})},6324:function(e,t,n){"use strict";var o=n(4);t.a=Object(o.action)("ON_KEYBOARD_UP_DOWN",function(e,t,n){return{selectionDirection:e,tableView:t,mailListItemSelectionSource:n}})},6325:function(e,t,n){"use strict";var o=n(4);t.a=Object(o.action)("ON_KEYBOARD_UP_DOWN",function(e,t,n,o){return{tableView:e,selectedNodeIds:t,selectedRowKeys:n,mailListItemSelectionSource:o}})},7330:function(e,t,n){"use strict";var o=n(4);t.a=Object(o.action)("ON_ITEM_PART_SELECTED",function(e,t){return{conversationNodeId:e,conversationId:t}})}},0,[3,4,9,13,421,0,1,2,576,189,6,377,23,575,185,17,359,5,329,7,8,10,12,130,11,43,126,570,147,341,374]]);
//# sourceMappingURL=owa.ExpandedListSelectionActions.js.map
self.scriptsLoaded['owa.ExpandedListSelectionActions.js'] = 1; self.scriptProcessEnd = self.scriptProcessEnd || {}; self.scriptProcessEnd['owa.ExpandedListSelectionActions.js'] = (new Date()).getTime();
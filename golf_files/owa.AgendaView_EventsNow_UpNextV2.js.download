self.scriptsLoaded = self.scriptsLoaded || {}; self.scriptProcessStart = self.scriptProcessStart || {}; self.scriptProcessStart['owa.AgendaView~EventsNow~UpNextV2.js'] = (new Date()).getTime();(window.$wj=window.$wj||[]).push([[42],{1466:function(e,t,n){"use strict";var r=n(4),a=Object(r.action)("updateLoadedDateRange",function(e,t){return{dateRange:e,scenarioId:t}}),c=Object(r.action)("updateCalendarEventLoadStates",function(e,t){return{calendarIds:e,scenarioId:t}}),o=Object(r.action)("resetCalendarEventLoadStates",function(e){return{scenarioId:e}}),i=Object(r.action)("updateLoadState",function(e,t){return{scenarioId:t,loadState:e}}),u=Object(r.action)("initializeScenario",function(e){return{scenarioId:e}}),d=Object(r.action)("updateIsInitializingCalendarEventsLoader",function(e,t){return{scenarioId:t,isInitializingCalendarEventsLoader:e}}),s=n(0),f=n(1412),l=n(764);function b(e){var t=Object(l.p)(e);return Object(s.__assign)(Object(s.__assign)({},t),{getOrderedEvents:function(t,n){return function(e,t,n){var r=Object(l.p)(n).getCalendarEventsForDateRange,a=[];return e.forEach(function(e){a.push.apply(a,Object(s.__spread)(r(e,t)))}),a.sort(f.a)}(t,n,e)}})}var v=n(1786),O=["ConflictsView","TimePanelAgendaCalendarCacheId","TimePanelAgenda_UpNextCalendarCacheId"];var j=n(20),h={scenarios:new j.ObservableMap},I=Object(r.createStore)("EventsLoadedStore",h),_=n(212),g=n(1538);function p(e){return Object(_.d)(e)&&!Object(_.c)(e)}function E(e){return Object(_.d)(e)&&Object(_.c)(e)}function w(e){return void 0===e&&(e=function(){return!0}),function(t,n){var r=Object(s.__read)(n,2),a=r[0],c=r[1];return e([a,c])&&t.push(a),t}}function L(e){return function(t){var n=Object(s.__read)(t,2);n[0];return n[1]===e}}function m(e){return F(e).eventsCacheLockId}function C(e){return z(e).map(function(t){return function(e,t){return Object(_.d)(t)?p(t)?x(e).get(t):Object(g.d)(t):"Loading"}(e,t)})}function S(e){return I().scenarios.has(e)?F(e).scenarioLoadState:"DoesNotExist"}function R(e){return F(e).loadedDateRange}function D(e,t){return P(e).reduce(w(L(t)),[])}function F(e){var t=I().scenarios.get(e);if(!t)throw new Error("getScenarioData should not be called until the calendar events loader scenario is initialized");return t}function N(e,t){var n=t||R(e),r=function(e){return z(e).filter(p).map(_.x)}(e),a=m(e),c=r?b(a).getOrderedEvents(r,n):[];return function(e){return!O.some(function(t){return t==e})&&Object(v.a)()}(e)||(c=c.filter(function(e){return"Decline"!==e.ResponseType})),c}function x(e){return F(e).calendarEventsLoadState}function P(e){return Object(s.__spread)(x(e).entries())}function z(e){return Object(s.__spread)(x(e).keys())}Object(r.mutator)(a,function(e){var t=e.scenarioId,n=e.dateRange;F(t).loadedDateRange=n}),Object(r.mutator)(i,function(e){var t=e.scenarioId,n=e.loadState;F(t).scenarioLoadState=n}),Object(r.mutator)(d,function(e){var t=e.scenarioId,n=e.isInitializingCalendarEventsLoader;F(t).isInitializingCalendarEventsLoader=n}),Object(r.mutator)(u,function(e){var t=e.scenarioId;I().scenarios.get(t)||I().scenarios.set(t,{eventsCacheLockId:Object(l.e)().getLockId(),loadedDateRange:null,scenarioLoadState:"Loading",calendarEventsLoadState:new j.ObservableMap({}),isInitializingCalendarEventsLoader:!0})}),Object(r.mutator)(l.v,function(e){var t=e.calendarId,n=e.loadingState,r=function(e){var t=Object(s.__spread)(I().scenarios.entries()).filter(function(t){var n=Object(s.__read)(t,2);return n[0],n[1].eventsCacheLockId===e});return t.length>0?{value:!0,scenarioId:t[0][0]}:{value:!1}}(e.lockId);if(r.value){var a=x(r.scenarioId);a.has(t.id)&&a.set(t.id,n)}}),Object(r.mutator)(c,function(e){var t=e.calendarIds,n=e.scenarioId,r=x(n);t.forEach(function(e){r.has(e)||r.set(e,"NotLoaded")}),z(n).forEach(function(e){t.some(function(t){return t===e})||r.delete(e)})}),Object(r.mutator)(o,function(e){var t=e.scenarioId,n=x(t);z(t).forEach(function(e){n.set(e,"NotLoaded")})});var y=Object(r.action)("initializeCalendarEventsLoader",function(e,t,n){return{calendarIds:e,dateRange:t,scenarioId:n}}),k=Object(r.action)("calendarEventsLoaderInitialized",function(e){return{scenarioId:e}}),U=Object(r.action)("updateCalendarIds",function(e,t){return{calendarIds:e,scenarioId:t}}),A=Object(r.action)("onCalendarIdsUpdated",function(e){return{scenarioId:e}}),M=Object(r.action)("onDateRangeUpdated",function(e,t){return{dateRange:e,scenarioId:t}}),T=Object(r.action)("loadFullEvent",function(e,t,n){return{scenarioId:e,id:t,parentFolderId:n}}),q=Object(r.action)("updateDateRange",function(e,t){return{dateRange:e,scenarioId:t}}),$=Object(r.action)("expandDateRange",function(e,t){return{numberOfDays:e,scenarioId:t}}),V=n(7);function B(e,t){return null===t||!Object(V.Fb)(e.start,t.start)||!Object(V.Fb)(e.end,t.end)}var G=n(63),H=function(e,t,n){return e&&0!==e.length?function(e,t,n){var r=this,a=m(n),c=Object(l.q)(a),o=e.map(function(e){return c.fetchCalendarEventsForDateRange(e,t)}),i=o.every(function(e){return null!==e.events}),u=new Promise(function(t){return Object(s.__awaiter)(r,void 0,void 0,function(){var n;return Object(s.__generator)(this,function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,Promise.all(o.map(function(e){return e.fetchPromise}))];case 1:return r.sent(),e.forEach(function(e){return c.subscribeNotifications(e)}),[3,3];case 2:return n=r.sent(),G.d.warn("loadEvents: Exception occured: "+n.message),[3,3];case 3:return t(),[2]}})})});return{canFetchAllEventsFromLocal:i,fetchPromise:u}}(e,t,n):{canFetchAllEventsFromLocal:!1,fetchPromise:new Promise(function(e){return Object(s.__awaiter)(void 0,void 0,void 0,function(){return Object(s.__generator)(this,function(t){return[2,e()]})})})}};function J(e,t,n){return Object(s.__awaiter)(this,void 0,void 0,function(){var r,a,c,o;return Object(s.__generator)(this,function(u){switch(u.label){case 0:return t.filter(p).length>0?(r=t.map(_.x),a=H(r,n,e),c=a.canFetchAllEventsFromLocal,o=a.fetchPromise,c||i("Fetching",e),[4,o]):[3,2];case 1:u.sent(),u.label=2;case 2:return[2]}})})}var K=function(e){return Object(s.__awaiter)(void 0,void 0,void 0,function(){return Object(s.__generator)(this,function(t){switch(t.label){case 0:return e?[4,Promise.all(e.filter(E).map(g.c).map(function(e){return e.catch(Q)}))]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})};function Q(e){return G.d.warn("Failed to update folderId:\n"+e),Promise.resolve()}function W(e){o(e),a(null,e)}function X(e,t){return Object(s.__awaiter)(this,void 0,void 0,function(){var n,r,o,u;return Object(s.__generator)(this,function(d){switch(d.label){case 0:return n=t.calendarIds,r=t.dateRange,c(n,e),o=D(e,"NotLoaded"),K(o),u=R(e),B(r,u)||0!==o.length?(i("Loading",e),B(r,u)&&W(e),[4,J(e,n,r)]):[3,2];case 1:d.sent(),a(r,e),i("Loaded",e),A(e),d.label=2;case 2:return[2]}})})}Object(r.orchestrator)(y,function(e){return Object(s.__awaiter)(void 0,void 0,void 0,function(){var t,n,r;return Object(s.__generator)(this,function(a){switch(a.label){case 0:if(t=e.scenarioId,n=e.calendarIds,r=e.dateRange,"DoesNotExist"===S(t))u(t);else if(function(e){return F(e).isInitializingCalendarEventsLoader}(t))return[2];return[4,X(t,{calendarIds:n,dateRange:r})];case 1:return a.sent(),k(t),d(!1,t),[2]}})})}),Object(r.orchestrator)(U,function(e){return Object(s.__awaiter)(void 0,void 0,void 0,function(){var t,n,r,a;return Object(s.__generator)(this,function(o){switch(o.label){case 0:return t=e.calendarIds,n=e.scenarioId,c(t,n),r=D(n,"NotLoaded"),K(r),a=R(n),0===r.length?[3,2]:(i("Loading",n),[4,J(n,r,a)]);case 1:o.sent(),i("Loaded",n),A(n),o.label=2;case 2:return[2]}})})}),Object(r.orchestrator)(q,function(e){return Object(s.__awaiter)(void 0,void 0,void 0,function(){var t,n,r;return Object(s.__generator)(this,function(c){switch(c.label){case 0:return t=e.dateRange,n=e.scenarioId,r=R(n),B(t,r)?(i("Loading",n),W(n),[4,J(n,z(n),t)]):[3,2];case 1:c.sent(),a(t,n),i("Loaded",n),M(t,n),c.label=2;case 2:return[2]}})})}),Object(r.orchestrator)($,function(e){return Object(s.__awaiter)(void 0,void 0,void 0,function(){var t,n,r,c;return Object(s.__generator)(this,function(o){switch(o.label){case 0:return t=e.scenarioId,n=e.numberOfDays,r=R(t),c={start:r.start,end:Object(V.e)(r.end,n)},i("Loading",t),[4,J(t,z(t),c)];case 1:return o.sent(),a(c,t),i("Loaded",t),[2]}})})}),Object(r.orchestrator)(T,function(e){return Object(s.__awaiter)(void 0,void 0,void 0,function(){var t,n,r,a;return Object(s.__generator)(this,function(c){return t=e.scenarioId,n=e.parentFolderId,r=e.id,a=m(t),(0,Object(l.q)(a).fetchFullCalendarEvent)(r,n?n.Id:null),[2]})})});var Y=n(2495);function Z(){Object(s.__spread)(I().scenarios.entries()).reduce(function(e,t){var n=Object(s.__read)(t,2),r=n[0],a=(n[1],P(r).reduce(w(L("NotLoaded")),[]));return a&&a.length>0&&e.push({scenarioId:r,calendarIds:a}),e},[]).forEach(function(e){var t=e.scenarioId;J(t,e.calendarIds,R(t))})}Object(r.orchestrator)(Y.b,Z),Object(r.orchestrator)(g.a,Z);n.d(t,"g",function(){return y}),n.d(t,"a",function(){return k}),n.d(t,"k",function(){return U}),n.d(t,"i",function(){return A}),n.d(t,"j",function(){return M}),n.d(t,"h",function(){return T}),n.d(t,"l",function(){return q}),n.d(t,"b",function(){return $}),n.d(t,"e",function(){return C}),n.d(t,"d",function(){return S}),n.d(t,"f",function(){return R}),n.d(t,"c",function(){return N})},2856:function(e,t,n){"use strict";var r=n(4),a=Object(r.action)("updateUpNextEvent",function(e,t){return{id:e,scenarioId:t}}),c={scenarios:new(n(20).ObservableMap)},o=Object(r.createStore)("UpNextStore",c);Object(r.mutator)(a,function(e){o().scenarios.set(e.scenarioId,e.id)});var i=n(764),u=n(0),d=n(1466),s=(Object(r.action)("cancelRefreshUpNextPoll",function(e){return{scenarioId:e}}),Object(r.action)("onUpNextEventUpdated",function(e,t,n){return{id:e,parentFolderId:t,scenarioId:n}})),f=Object(r.action)("initializeUpNextEventLoader",function(e,t){return{calendarIds:e,scenarioId:t}}),l=n(7);function b(){var e=Object(l.hc)(),t=Object(l.e)(e,1);return{start:e,end:Object(l.A)(t)}}var v=n(742),O=n(830),j=n(1412),h=n(33);function I(e,t){void 0===t&&(t=!1);var n=Object(l.Nb)(),r=Object(u.__spread)(e);return t||r.sort(j.a),function(e,t){if(!e||0===e.length)return null;var n=e.filter(_(t));if(0===n.length)return null;if(1===n.length)return n[0];return n.reduce(function(e,n){if(0===e.length)return[n];var r=g(e[0].Start,t),a=g(n.Start,t);return a<r?[n]:a===r?(e.push(n),e):e},[]).sort(j.b)[0]}(r,n)}function _(e){return function(t){var n=Object(l.Eb)(t.End,e),r=Object(l.w)(t.End,t.Start)>h.c,a=!Object(O.c)(t),c=Object(v.u)(t);return!n&&!r&&!t.IsAllDayEvent&&!t.IsCancelled&&!t.IsDraft&&"Decline"!==t.ResponseType&&a&&c}}function g(e,t){return Math.abs(Object(l.w)(e,t))}var p=n(899);function E(e){var t=b();return Object(d.c)(e,t).filter(Object(p.d)(t))}var w=n(322);function L(e,t){var n=Object(w.h)();return t.ItemId.Id!==e.ItemId.Id&&(Object(j.e)(t,e)&&!Object(l.Cb)(t.Start,e.Start)&&_(n)(t))}function m(e){return o().scenarios.get(e)}function C(e){var t=m(e);return t?function(e,t){return E(e).filter(function(e){return e.ItemId.Id===t.Id})[0]||null}(e,t):null}function S(e){var t=C(e);if(!t)return{upNextEvent:null,conflictingEvents:[]};var n=E(e).filter(function(e){return L(t,e)});return{upNextEvent:t,conflictingEvents:n}}function R(e){return o().scenarios.has(e)}function D(){return Object(u.__spread)(o().scenarios.keys())}function F(e){return Object(u.__awaiter)(this,void 0,void 0,function(){var t,n;return Object(u.__generator)(this,function(r){return t=function(e){return I(E(e),!0)}(e),n=t?t.ItemId:null,m(e)===n?[2]:(a(n,e),s(n,t?t.ParentFolderId:null,e),[2])})})}function N(){D().forEach(F)}Object(r.orchestrator)(i.b,function(){N()}),Object(r.orchestrator)(i.c,function(){N()}),Object(r.orchestrator)(i.a,function(){N()}),Object(r.orchestrator)(f,function(e){var t=e.calendarIds,n=e.scenarioId,r=b();R(n)||a(null,n),Object(d.g)(t,r,n)});var x=n(1757);Object(r.orchestrator)(d.a,function(e){return Object(u.__awaiter)(void 0,void 0,void 0,function(){var t;return Object(u.__generator)(this,function(n){switch(n.label){case 0:return R(t=e.scenarioId)?[4,F(t)]:[3,2];case 1:n.sent(),Object(x.b)(function(){return function(e){return Object(u.__awaiter)(this,void 0,void 0,function(){return Object(u.__generator)(this,function(t){switch(t.label){case 0:return[4,F(e)];case 1:return t.sent(),[2,null]}})})}(t)},t,1e4),n.label=2;case 2:return[2]}})})});Object(r.orchestrator)(d.j,function(e){var t=e.scenarioId;R(t)&&F(t)}),Object(r.orchestrator)(w.j,function(){D().forEach(function(e){return Object(d.l)(b(),e)})}),Object(r.orchestrator)(d.i,function(e){var t=e.scenarioId;R(t)&&F(t)});n.d(t,"g",function(){return s}),n.d(t,"d",function(){return f}),n.d(t,"i",function(){return d.k}),n.d(t,"a",function(){return C}),n.d(t,"b",function(){return m}),n.d(t,"c",function(){return S}),n.d(t,"f",function(){return R}),n.d(t,"e",function(){return L}),n.d(t,"h",function(){return N})}}]);
//# sourceMappingURL=owa.AgendaView~EventsNow~UpNextV2.js.map
self.scriptsLoaded['owa.AgendaView~EventsNow~UpNextV2.js'] = 1; self.scriptProcessEnd = self.scriptProcessEnd || {}; self.scriptProcessEnd['owa.AgendaView~EventsNow~UpNextV2.js'] = (new Date()).getTime();